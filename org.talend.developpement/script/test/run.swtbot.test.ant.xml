<project name="talend.swtbot.tests.ant.project" default="swtbot.test.for.tos" basedir=".">
	<dirname property="this.swtbot.test.build.file.dir" file="${ant.file.talend.swtbot.tests.ant.project}"  />
<!--    <property name="rcp-app-home" value="${this.swtbot.test.build.file.dir}\..\.." />-->
<!--     <property name="rcp-app-home" value="E:\java\Talend\TOSTestDistrib\TDQ_EE_MPX-All-r51548-V4.2.0NB\TDQ_EE_MPX-All-r51548-V4.2.0NB" />
-->
	<property name="test-plugin-name" value="test.all.test.suite" />
    <property name="test-class-name" value="org.talend.test.AllSwtBotTestsForJUnit4Suite" />
    <property name="library-file" value="${rcp-app-home}/plugins/org.eclipse.swtbot.eclipse.junit4.headless_2.0.0.595-dev-e36/library.xml"/>
    <property name="test-application" value="org.talend.rcp.branding.tos.product"/>
	<property name="temp-workspace" value="${rcp-app-home}/workspace" />
 	<property name="junit.results.subpath" value="junit-results.xml" />
 	<property name="log.path" value="${rcp-app-home}/.log" />
 		
		
	
	<!-- the following properties defines the way to find all the classes that we want to test-->
	<property name="test.plugin.prefix" value="org.talend.tos"/><!-- This may be a list of comma separated prefixes -->
	<property name="test.plugin.suffix" value="swtbot.test"/><!-- This may be a list of comma separated suffixes -->
	<property name="test.package.prefix" value="tos"/><!-- This may be a list of comma separated prefixes -->
	<property name="test.class.filter" value="*"/>
	<property name="test.only.fragments" value="false"/>
	<propertyset id="test.class.collector.properties" description="defines all the prefix and suffix used to find the classes to tested">
		<propertyref prefix="test."/>
	</propertyset>

	<target name="init">
		<tstamp />
		<fail unless="rcp-app-home" message="You must set the rcp-app-home property to specify the path the RCP application to test"/>
 		<delete includeemptydirs="true" quiet="true">
			<fileset dir="${rcp-app-home}" includes="${junit.results.subpath}" />
			<fileset file="${log.path}"/>
    		<fileset dir="${rcp-app-home}/configuration" includes="**/*" excludes="config.ini"/>
    		<fileset dir="${temp-workspace}" includes="**/*" excludes=".JETEmitters/**/*.*"/>
    		<fileset dir="${rcp-app-home}/screenshots"/>
		</delete>
	</target>

	<!-- ================================= 
          target: swtbot.test.for.tos               
         ================================= -->
    <target name="swtbot.test.for.tos" depends="init" description="launch swt bot test for TOS, output junit is localted a TOS root and named junit-results.xml, the console output is also located at the root">
    	<echo>SWTBot test</echo>
    	<java dir="${rcp-app-home}" fork="true" output="${log.path}" logError="true"
    	classname="org.eclipse.core.launcher.Main" failonerror="false">
    		<syspropertyset refid="test.class.collector.properties"/>
    	    <classpath>
    	        <fileset dir="${rcp-app-home}/plugins">
    	            <include name="org.eclipse.equinox.launcher_*.jar"/>
    	        </fileset>
    	    </classpath>
    	    <arg line="-application org.eclipse.swtbot.eclipse.junit4.headless.swtbottestapplication"/>
    	    <arg line="-testPluginName ${test-plugin-name}"/>
    	    <arg line="-testApplication ${test-application} -clean -nl en --disableLoginDialog -project TEST_NOLOGIN --deleteProjectIfExist -language java -login a@b.c"/>
    	    <arg line="-className ${test-class-name}"/>
    	    <arg line="formatter=org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter,${junit.results.subpath}"/>
    	    <arg line="-consoleLog"/>
    	    <jvmarg line="-Xms128m -Xmx1024m -XX:MaxPermSize=256m -XX:+HeapDumpOnOutOfMemoryError -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1716"/>
    	</java>        
    </target>
</project>