<project name="talend.swtbot.tests.ant.project" default="swtbot.test.for.tos" basedir=".">
	<dirname property="this.swtbot.test.build.file.dir" file="${ant.file.talend.swtbot.tests.ant.project}"  />
<!--    <property name="rcp-app-home" value="${this.swtbot.test.build.file.dir}\..\.." />-->
    <property name="rcp-app-home" value="E:\java\Talend\TOSTestDistrib\TDQ_EE_MPX-All-r51548-V4.2.0NB\TDQ_EE_MPX-All-r51548-V4.2.0NB" />
    <property name="test-plugin-name" value="test.all.test.suite" />
    <property name="test-class-name" value="org.talend.test.AllSwtBotTestsForJUnit4Suite" />
    <property name="library-file" value="${rcp-app-home}/plugins/org.eclipse.swtbot.eclipse.junit4.headless_2.0.0.595-dev-e36/library.xml"/>
    <property name="test-application" value="org.talend.rcp.branding.tos.product"/>
	<property name="temp-workspace" value="${rcp-app-home}/workspace" />

	<property name="test.plugin.prefix" value="org.talend.tos"/>
	<property name="test.plugin.suffix" value="swtbot.test"/>
	<property name="test.package.prefix" value="tos"/><!-- MUST NEVER be EMTPY-->
	<property name="test.class.filter" value="*"/>
	<property name="test.only.fragments" value="false"/>
	<propertyset id="test.class.collector.properties" description="defines all the prefix and suffix used to find the classes to tested">
		<propertyref prefix="test."/>
	</propertyset>

	<target name="init">
		<tstamp />
 		<delete includeemptydirs="true">
			<fileset dir="${rcp-app-home}" includes="*.xml" />
			<fileset dir="${rcp-app-home}" includes=".log" />
    		<fileset dir="${rcp-app-home}/configuration" includes="**/*" excludes="config.ini"/>
    		<fileset dir="${temp-workspace}" includes="**/*" excludes=".JETEmitters/**/*.*"/>
    		<fileset dir="${rcp-app-home}/screenshots"/>
		</delete>
	</target>


<!--     <target name="suite">
    	<ant target="swtbot-test" antfile="${library-file}" dir="${rcp-app-home}">
             <property name="data-dir" value="${temp-workspace}" />
            <property name="os" value="win32" />
            <property name="ws" value="win32" />
            <property name="arch" value="x86" />
            <property name="testApplication" value="${test-application} -clean -nl en -disableLoginDialog -project TEST_NOLOGIN -deleteProjectIfExist -language java -login a@b.c" />
            <property name="plugin-name" value="${test-plugin-name}" />
            <property name="classname" value="${test-class-name}" />
            <property name="vmargs" value=" -Xms128M -Xmx1024M -XX:MaxPermSize=256M" />
        </ant>
    </target>
-->
	<!-- ================================= 
          target: swtbot.test.for.tos               
         ================================= -->
    <target name="swtbot.test.for.tos" depends="init" description="launch swt bot test for TOS, output junit is localted a TOS root and named junit-results.xml, the console output is also located at the root">
    	<echo>SWTBot test</echo>
    	<java dir="${rcp-app-home}" fork="true" output="${rcp-app-home}/.log" logError="true"
    	classname="org.eclipse.core.launcher.Main" failonerror="false">
    		<syspropertyset refid="test.class.collector.properties"/>
    	    <classpath>
    	        <fileset dir="${rcp-app-home}/plugins">
    	            <include name="org.eclipse.equinox.launcher_*.jar"/>
    	        </fileset>
    	    </classpath>
    	    <arg line="-application org.eclipse.swtbot.eclipse.junit4.headless.swtbottestapplication"/>
    	    <arg line="-testPluginName ${test-plugin-name}"/>
    	    <arg line="-testApplication ${test-application} -clean -nl en --disableLoginDialog -project TEST_NOLOGIN --deleteProjectIfExist -language java -login a@b.c"/>
    	    <arg line="-className ${test-class-name}"/>
    	    <arg line="formatter=org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter,junit-results.xml"/>
    	    <arg line="-consoleLog"/>
    	    <jvmarg line="-Xms128m -Xmx1024m -XX:MaxPermSize=256m -XX:+HeapDumpOnOutOfMemoryError"/>
    		
    	</java>        
    </target>
</project>