<project name="testng" default="run-tests" basedir=".">
	<propertyset id="tests.properties">
		<propertyref name="selenium.target.src"/>
	    <propertyref name="tests.on.hudson"/>
		<propertyref name="tomcat.url"/>
		<propertyref name="selenium.server"/>
		<propertyref name="selenium.browser"/>
		<propertyref name="zookeeper.path"/>
		<propertyref name="talend-all.home"/>
	</propertyset>
	
	<!-- testng path -->
	<taskdef name="svn" classname="org.tigris.subversion.svnant.SvnTask" />

	<taskdef name="testng" classname="org.testng.TestNGAntTask">
		<classpath>
			<pathelement location="${hudson.selenium.libs}/testng-6.0.1.jar" />
		</classpath>
	</taskdef>

	<path id="libs.classpath">
		<!-- <pathelement location="./libs/junit.jar"/> -->
		<fileset dir="${hudson.selenium.libs}" id="libs.path.id">
		    <include name="*.jar"/>
		</fileset>
	</path>

	<path id="src.classpath">
		<pathelement location="${selenium.project}/src/main/java" />
		<pathelement location="${selenium.project}/src/main/resources" />
	</path>	

	<path id="target.classpath">
		<pathelement location="${selenium.target}" />
	</path>

	<path id="test.classpath">
		<path refid="libs.classpath" />
		<path refid="target.classpath" />
	</path>
	
	<target name="init-test" description="Preparation">
		<mkdir dir="${report_dir}"/>
		<mkdir dir="${selenium.project}"/>
		<mkdir dir="${selenium.target}"/>
	</target>

	<target name="destory-test" description="Destory">
		<delete dir="${selenium.target}"/>
		<delete dir="${selenium.project}"/>
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          checkout tests and copy license to Talend-all                    
         - - - - - - - - - - - - - - - - - -->
	<target name="checkout" description="checkout">
		
		<antcall target="destory-test"/>
		<antcall target="init-test"/>
		
		<svn username="${svn.user}" password="${svn.password}">
			<checkout url="${svn.url}" revision="HEAD" destPath="${selenium.project}"/>
		</svn>
		
		<!-- Copy license to Talend-All -->
		<copy todir="${talend-all.home}">
			<fileset dir="${selenium.project}/${selenium.file.folder}">
				<include name="license" />
			</fileset>
		</copy>
	</target>

	
	<target name="compile-test" description="Compilation of the test clas	ses">
		<echo>compile tests ----</echo>
		<!-- Compilation of the Selenium tests -->
		<javac srcdir="${selenium.project}/src" debug="true" debuglevel="lines,vars,source" 
				destdir="${selenium.target}" includeantruntime="false">
			<classpath refid="libs.classpath" />
			<classpath refid="src.classpath" />
		</javac>
		<echo>44444</echo>
		<copy todir="${selenium.target}">
			<fileset dir="${selenium.project}/src/main/resources">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy todir="${selenium.target}/${selenium.file.folder}">
			<fileset dir="${selenium.project}/${selenium.file.folder}">
				<include name="*" />
			</fileset>
		</copy>
		<copy todir="${selenium.target}/src/main/java/org/talend/tac/folder">
			<fileset dir="${selenium.project}/src/main/java/org/talend/tac/folder">
				<include name="**/*" />
			</fileset>
		</copy>

		<copy todir="${selenium.target}/src/main/java">
			<fileset dir="${selenium.project}/src/main/java" casesensitive="yes">
				<include name="**/*.xml" />
			</fileset>
		</copy>

		<echo>Compilation of the test classes</echo>
	</target>


	<target name="compile-tests" description="Compilation of the test classes">
		<echo>${hudson.selenium.libs}</echo>
		<echo>compile tests ----</echo>
		<!-- Compilation of the Selenium tests -->
		<javac srcdir="${selenium.project}/src" debug="true" debuglevel="lines,vars,source" 
				destdir="${selenium.target}" includeantruntime="false">
			<classpath refid="libs.classpath" />
			<classpath refid="src.classpath" />
		</javac>
		<echo>44444</echo>
		<copy todir="${selenium.target}">
			<fileset dir="${selenium.project}/src/main/resources">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy todir="${selenium.target}/${selenium.file.folder}">
			<fileset dir="${selenium.project}/${selenium.file.folder}">
				<include name="*" />
			</fileset>
		</copy>

		<copy todir="${selenium.target}/src/main/java">
			<fileset dir="${selenium.project}/src/main/java" casesensitive="yes">
				<include name="**/*.xml" />
			</fileset>
		</copy>

		<echo>Compilation of the test classes</echo>
	</target>
	
	<!-- Run the TestNG tests depends="compile-test"  -->
	<target name="testng-test" description="Run the TestNG tests">
		<testng outputdir="${report_dir}" classpathref="test.classpath">
			<xmlfileset dir="${selenium.target}/src/main/java" includes="${xmlfile}.xml" />
			<propertyset refid="tests.properties"/>
		</testng>
		<echo>Run the TestNG tests</echo>
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: run                      
         - - - - - - - - - - - - - - - - - -->
    <target name="run-tests">
        <echo>--build.version----- ${build.version}</echo>
    	<echo>--- tac.home --- ${tac.home}</echo>
		<antcall target="testng-test"/>
    </target>

</project>
